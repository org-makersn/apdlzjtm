@model PagedList.IPagedList<Net.Framework.StoreModel.StoreProductT>
@using PagedList.Mvc;
@{
    ViewBag.Title = "ProductCertificateList";
}

<div class="contents_zone">
    <h2 class="contents_title">ShapeWays 업로드</h2>

    <div class="bannerCate">
        <a href="/Store/ProductCertificateList?status=1">심사요청</a>l<a href="/Store/ProductCertificateList?status=2">거부된 상품</a>l<a href="/Store/ProductCertificateList?status=3">심사완료된 상품</a>l<a href="/Store/ProductCertificateList?status=4">업로드된 상품</a>
    </div>
    <!-- list_search_zone -->
    <form id="search" name="search">
        <table class="tbstyle01" summary="검색 테이블" style="margin-bottom: 10px;">
            <colgroup>
                <col width="100px" />
                <col width="auto" />
            </colgroup>
            <caption>게시판</caption>
            <tbody>
                <tr>
                    <th scope="row">검색</th>
                    <td>
                        @*<select id="sfl" name="sfl" style="width: 130px">
                            <option value="title">제목</option>
                        </select>*@
                        <input type="text" id="query" name="query" class="input_text" style="width: 200px; padding: 1px 0" value="@ViewData["query"]" />
                        <input type ="hidden" id ="certificateType" name="certificateType" value ="@ViewData["certificateType"]" />
                        <span class="btnWrap small"><a href="javascript:void(0);" class="_search_btn" id="search_btn">검색</a></span>
                        <span class="btnWrap small" style="margin-left: 10px;"><a href="javascript:void(0);" class="_reset" onclick="$('#query').val('');">재설정</a></span>
                    </td>
                </tr>

            </tbody>
        </table>
    </form>
    <!-- //list_search_zone -->

    <div class="right_float_wrap">
        <div class="left"><strong>@ViewData["cnt"]</strong> 의 리스트</div>
    </div>

    <table cellpadding="0" cellspacing="0" border="0" class="tbl_style" summary="">
        <caption>리스트 게시판</caption>
        <colgroup>
            <col width="8%" />
            <col width="10%" />
            <col width="*" />
            <col width="10%" />
            <col width="15%" />
        </colgroup>
        <thead>
            <tr>
                <th>제품번호</th>
                <th>제품명</th>
                <th>파일명</th>
                <th>모델부피</th>
                <th>슬라이싱 된 부피</th>
                <th>관리</th>
            </tr>
        </thead>
        <tbody>
            @if ((int)ViewData["cnt"] > 0)
            {
                foreach (var p in Model)
                {
                <tr>
                    <td>@p.NO</td>
                    @*<td>
                        <p class="memb_img">
                            <a href="javascript:Banner.GoEdit(@p.No)" class="_btn_edit" id="img">
                                <img src="@Url.Content(ViewBag.BannerUrl+"thumb/"+ b.Image)" /></a>
                        <p>
                    </td>*@
                    <td class="ta_left"><a href="javascript:Banner.GoEdit(@p.NO)" class="_btn_edit" id="title">@p.NAME</a></td>
                    <td>@p.FILE_NAME</td>
                    <td>@p.OBJECT_VOLUME</td>
                    <td>@p.MATERIAL_VOLUME</td>

                    <td>
                        @if (ViewData["certificateType"].ToString().Equals("1"))
                        {
                            <button onclick="javascript:accept(@p.NO)">승인</button> 
                            <button onclick="javascript:reject(@p.NO)">거부</button>
                        }
                        else if (ViewData["certificateType"].ToString().Equals("3"))
                        {
                            <button onclick="javascript:uploadFinished(@p.NO)">업로드 완료</button> 
                        }

                    </td>
                </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" style="height: 200px; text-align: center; vertical-align: middle;">제품이 없습니다.</td>
                </tr>	
            }
        </tbody>
    </table>
    <!-- page_navi -->
    <div class="page_navi">
        @Html.PagedListPager(Model, page => Url.Action("/", new { page }))
    </div>
    <!-- // page_navi -->
    @* <!-- btn -->
    <div class="btn_right">
        <span class="btnWrap medium"><a href="#" id="AddBanner" class="_btn_write">등록</a></span>
    </div>
    <!-- // btn -->*@

</div>


@section Scripts{
    <script type="text/javascript">


        $(document).ready(function () {
            $("#search_btn").click(function () {
                var gubun = $("#certificateType").val();
                var query = $("#query").val();
                location.replace("/Store/ProductCertificateList?status=" + "@ViewData["certificateType"]" + "&query=" + query);
            });
        });
        function accept(val) {
            var result = Ajax.SyncPostService("/Store/ChangeCertiFicateStatus", { no: val, status: "@((int)Makersn.Util.MakersnEnumTypes.ProductCertificateStatus.Accept)" });
            console.log(result);
            if (result.result == 1) {
                location.reload(true);
            }
        }
        function reject(val) {
            var result = Ajax.SyncPostService("/Store/ChangeCertiFicateStatus", { no: val, status: "@((int)Makersn.Util.MakersnEnumTypes.ProductCertificateStatus.Reject)" });
            console.log(result);
            if (result.result == 1) {
                location.reload(true);
            }
        }

        function uploadFinished(val) {
            var result = Ajax.SyncPostService("/Store/ChangeCertiFicateStatus", { no: val, status: "@((int)Makersn.Util.MakersnEnumTypes.ProductCertificateStatus.UploadFinished)" });
            console.log(result);
            if (result.result == 1) {
                location.reload(true);
            }
        }

        //ArticleRecommendRequest.visibility = function (val) {
        //    var no = "";
        //    $("input[name=chkAll]").each(function () {
        //        if ($(this).is(":checked")) {
        //            if ($(this).val() != "on") {
        //                no += $(this).val() + ",";
        //            }
        //        }
        //    });
        //    var result = Ajax.SyncPostService("/ArticleRecommendRequest/SetVisibiliy", { no: no, setVisi: val });
        //    console.log(result);
        //    if (result.result == 1) {
        //        location.reload(true);
        //    }
        //}

    </script>
}