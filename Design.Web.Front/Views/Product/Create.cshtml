@*@{
    ViewBag.Title = "ProductUpload";
}

<h2>ProductUpload</h2>

제품 올리기 <br />
<br />

제품     STORE_PRODUCT<br />
제품상세 STORE_PRODUCT_DETIAL<br />
*@



@{
    ViewBag.Title = "디자인 업로드";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="subtitle">
    <h2>디자인 업로드</h2>
    @*<a href="javascript:void(0);" onclick="upguidePop();">
        <img src="@Url.Content("~/Content/images/common/btn/btn_upload_guide.gif")" alt="업로드 가이드" /></a>*@
    <a class="upload_guide" href="javascript:void(0);" onclick="upguidePop();">업로드 가이드</a>
</div>

<!-- uploadWrap -->
<div class="uploadWrap">
    <form id="insert_form" name="insert_form" method="post" enctype="multipart/form-data">
        <input type="hidden" id="No" name="No" />
        <input type="hidden" id="temp" name="temp" value="@ViewBag.Temp" />
        <input type="hidden" id="main_img" name="main_img" value="" />
        <input type="hidden" id="mode" name="mode" value="write">
        <input type="hidden" id="del_no" name="del_no" value="">
        <input type="hidden" id="uploadCnt" name="uploadCnt" value="10">
        <input type="hidden" id="insertVideoSource" name="insertVideoSource" />

        <!-- File Upload -->
        <div class="uploadFile">

            <!-- 3D 모델링 파일 -->
            <div class="modelFile">
                <div class="upBtnZone">
                    <p class="title">3D 모델링 파일</p>
                    <div class="btnAdd">
                        <button class="file_input_button" title="파일추가"></button>
                        <input type="file" class="file_input_hidden" name="ProductStlUploads" id="ProductStlUploads" multiple/>
                        <div class="btnLoading" style="display: none;">
                            @*<img src="@Url.Content("~/Content/images/common/loadingBg.gif")" alt="업로드중입니다." title="업로드중입니다." />*@
                            <div id="progressbar" style="margin: 0px 0px 16px 0px;"><span style="position: absolute; text-align: center; font-size:large; width: 269px; margin: 7px 0 0 0;">My %</span></div>
                        </div>
                    </div>
                </div>
                <p class="txt">타입 : stl, obj / 최대 사이즈 : 개당 100mb</p>
            </div>
            <!-- //3D 모델링 파일 -->


            <!-- 이미지 파일 -->
            <div class="imgFile">
                <div class="upBtnZone">
                    <p class="title">이미지 파일</p>
                    <div class="btnAdd">
                        <button class="file_input_button" title="파일추가"></button>
                        <input type="file" class="file_input_hidden" name="imguploads" id="imguploads" multiple/>
                    </div>
                </div>
                <p class="txt">타입 : gif, jpg, png / 최대 사이즈 : 개당 100mb / 권장 해상도 630*470px</p>
            </div>
            <!-- //이미지 파일 -->
        </div>
        

        <!-- //inputUpload -->
    </form>
</div>
  

<input type="hidden" id="showIndex" />

@section Scripts{


    <link rel="stylesheet" type="text/css" href="@Url.VersionedContent("~/Content/css/jquery-ui-1.8.18.custom.css")" />
    <script type="text/javascript" src="@Url.VersionedContent("~/Scripts/jquery.easing.1.3.js")"></script>
    <script type="text/javascript" src="@Url.VersionedContent("~/Scripts/jquery.bxslider.min.js")"></script>
    <script type="text/javascript" src="@Url.VersionedContent("~/Scripts/jquery-ui.js")"></script>
    <script type="text/javascript" src="@Url.VersionedContent("~/Scripts/jquery.form.min.js")"></script>


    @*<script src="@Url.VersionedContent("~/Scripts/Thingiview/Three.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/Thingiview/plane.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/Thingiview/thingiview.js")"></script>*@
    
    @*<script src="@Url.VersionedContent("~/Scripts/three.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/plane.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/thingiview2.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/STLLoader.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/OBJLoader.js")"></script>
    <script src="@Url.VersionedContent("~/Scripts/NormalControls.js")"></script>*@

    
    <script src="@Url.VersionedContent("/Scripts/makersnView/three.js")"></script>
    <script src="@Url.VersionedContent("/Scripts/makersnView/STLLoader.js")"></script>
    <script src="@Url.VersionedContent("/Scripts/makersnView/OBJLoader.js")"></script>
    <script src="@Url.VersionedContent("/Scripts/makersnView/NormalControls.js")"></script>
    <script src="@Url.VersionedContent("/Scripts/makersnView/TrackballControls.js")"></script>
    <script src="@Url.VersionedContent("/Scripts/makersnView/viewer.js")"></script>
    
@*    <script src="@Url.VersionedContent("~/Scripts/three.js")"></script>
    @Scripts.Render("~/bundles/viewer")*@

    <script type="text/javascript" src="@Url.VersionedContent("~/Scripts/Article/Upload.js")"></script>

    <script type="text/javascript">
        $(function () {
            $("#ProductStlUploads").on("change", function (e) {
                e.preventDefault();
                var fileobj = $("#ProductStlUploads");
                if (UploadValidExtension("3d", fileobj) === false) {
                    return false;
                }

                UploadFile("/Product/StlUpload", fileobj);
            });
        });

       

        //파일 업로드
        UploadFile = function (action, element) {
           

            $("#mode").val("temp");
            var $form_data = $("#insert_form").serialize();
            var options = {
                beforeSend: function () {
                    //$('.btnLoading').show();
                },
                uploadProgress: function (event, position, total, percentComplete) {
                    //console.log(percentComplete)
                    $('.btnLoading').show();

                    $("#progressbar").find("span").text(percentComplete + "%");
                },
                success: function (response) {
                    window.location.href = "/Product/ProductUploadDetail?productNo=" + response.ProductNo;

                    ////console.log(response);

                    //if (response.Success) {
                    //    $(".imgDefualt").show();

                    //    //Upload.GetArticleFiles(response.Result);

                    //    for (var i = 0; i < response.Count; i++) {
                    //        uploadFileCnt++;
                    //        if (uploadFileCnt >= uploadCnt) {
                    //            Upload.More();
                    //        }
                    //        Upload.AppendFile(response.Result[i], uploadFileCnt);
                    //    }


                    //    //setTimeout("Upload.StlTrigger(" + response.Result + ")", 500);

                    //    if ($(element).attr('id') == "imguploads") {//이미지만 열리게 해둠
                    //        $(".popupArea.uploadMask").hide();
                    //    }
                    //    $(".popupArea.uploadMask").hide();//stl도 그냥 닫히게 열어둠

                    //    //$('.btnLoading').hide();
                    //}
                    //else {
                    //    alert(response.Message);
                    //    //alert("success and response false");
                    //}
                },
                complete: function (response) {
                    $(element).val("");
                    $('.btnLoading').hide();
                    alert("complate");
                },
                error: function (error) {
                    console.log(error);
                    //alert("error");
                }
            };

            $('#insert_form').attr("action", action).ajaxForm(options).submit();
        }


        //파일 확장자 체크
        UploadValidExtension = function (type, fileobj) {
            var regex;

            if (fileobj[0].files[0].size > 100 * 1024 * 1024) {
                alert('최대 사이즈를 초과하였습니다.');
                return false;
            }

            if (type == "img") {

                regex = /(.jpg|.jpeg|.gif|.png)$/i;
                if (!regex.test(fileobj.val().toLowerCase())) {
                    alert('gif, jpg, png 형식 파일만 가능합니다.');
                    return false;
                }
            }
            else if (type == "3d") {
                regex = /(.stl|.obj)$/i;
                if (!regex.test(fileobj.val().toLowerCase())) {
                    alert('stl, obj 형식 파일만 가능합니다.');
                    return false;
                }
            }
            else {
                alert('파일 타입을 확인해주세요.');
                return false;
            }
        }



        
    </script>
}